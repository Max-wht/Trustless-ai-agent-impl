<!DOCTYPE html>
<html>
<head>
    <title>Anvil é’±åŒ…è¿æ¥è¯Šæ–­</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            background: #2563EB;
            color: white;
            border: none;
            border-radius: 5px;
        }
        button:hover {
            background: #1d4ed8;
        }
        .result {
            background: #f3f4f6;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            white-space: pre-wrap;
        }
        .success {
            background: #d1fae5;
            border-left: 4px solid #10b981;
        }
        .error {
            background: #fee2e2;
            border-left: 4px solid #ef4444;
        }
        h1 {
            color: #1f2937;
        }
    </style>
</head>
<body>
    <h1>ğŸ” Anvil é’±åŒ…è¿æ¥è¯Šæ–­å·¥å…·</h1>
    
    <div>
        <button onclick="checkWallet()">1. æ£€æŸ¥é’±åŒ…æ˜¯å¦å¯ç”¨</button>
        <button onclick="getCurrentChain()">2. è·å–å½“å‰ç½‘ç»œ</button>
        <button onclick="addAnvilNetwork()">3. æ·»åŠ  Anvil ç½‘ç»œ</button>
        <button onclick="switchToAnvil()">4. åˆ‡æ¢åˆ° Anvil</button>
        <button onclick="connectWallet()">5. è¿æ¥é’±åŒ…</button>
    </div>
    
    <div id="results"></div>

    <script>
        const resultsDiv = document.getElementById('results');

        function addResult(message, isSuccess = true) {
            const div = document.createElement('div');
            div.className = `result ${isSuccess ? 'success' : 'error'}`;
            div.textContent = message;
            resultsDiv.appendChild(div);
        }

        async function checkWallet() {
            resultsDiv.innerHTML = '';
            
            if (typeof window.ethereum !== 'undefined') {
                addResult('âœ… é’±åŒ…å·²å®‰è£…', true);
                
                try {
                    const accounts = await window.ethereum.request({ 
                        method: 'eth_accounts' 
                    });
                    
                    if (accounts.length > 0) {
                        addResult(`âœ… å·²è¿æ¥è´¦æˆ·: ${accounts[0]}`, true);
                    } else {
                        addResult('âš ï¸ é’±åŒ…æœªè¿æ¥ï¼Œè¯·å…ˆè¿æ¥é’±åŒ…', false);
                    }
                } catch (error) {
                    addResult(`âŒ æ£€æŸ¥è´¦æˆ·å¤±è´¥: ${error.message}`, false);
                }
            } else {
                addResult('âŒ æœªæ£€æµ‹åˆ°é’±åŒ…ï¼Œè¯·å®‰è£… MetaMask æˆ–å…¶ä»– Web3 é’±åŒ…', false);
            }
        }

        async function getCurrentChain() {
            resultsDiv.innerHTML = '';
            
            try {
                const chainId = await window.ethereum.request({ 
                    method: 'eth_chainId' 
                });
                const chainIdDecimal = parseInt(chainId, 16);
                
                addResult(`å½“å‰ Chain ID (hex): ${chainId}`, true);
                addResult(`å½“å‰ Chain ID (decimal): ${chainIdDecimal}`, true);
                
                if (chainIdDecimal === 31337) {
                    addResult('âœ… å·²è¿æ¥åˆ° Anvil (31337)', true);
                } else {
                    addResult(`âš ï¸ æœªè¿æ¥åˆ° Anvilï¼Œå½“å‰ç½‘ç»œ: ${chainIdDecimal}`, false);
                    addResult('é¢„æœŸ Chain ID: 31337', false);
                }
            } catch (error) {
                addResult(`âŒ è·å–ç½‘ç»œå¤±è´¥: ${error.message}`, false);
            }
        }

        async function addAnvilNetwork() {
            resultsDiv.innerHTML = '';
            
            try {
                await window.ethereum.request({
                    method: 'wallet_addEthereumChain',
                    params: [{
                        chainId: '0x7a69', // 31337 in hex
                        chainName: 'Anvil',
                        nativeCurrency: {
                            name: 'Ether',
                            symbol: 'ETH',
                            decimals: 18
                        },
                        rpcUrls: ['http://127.0.0.1:8545'],
                    }]
                });
                
                addResult('âœ… Anvil ç½‘ç»œå·²æ·»åŠ æˆåŠŸï¼', true);
                addResult('ç½‘ç»œä¿¡æ¯:', true);
                addResult('  Chain ID: 31337 (0x7a69)', true);
                addResult('  RPC URL: http://127.0.0.1:8545', true);
            } catch (error) {
                if (error.code === 4902) {
                    addResult('â„¹ï¸ ç½‘ç»œå·²å­˜åœ¨', true);
                } else {
                    addResult(`âŒ æ·»åŠ ç½‘ç»œå¤±è´¥: ${error.message}`, false);
                }
            }
        }

        async function switchToAnvil() {
            resultsDiv.innerHTML = '';
            
            try {
                await window.ethereum.request({
                    method: 'wallet_switchEthereumChain',
                    params: [{ chainId: '0x7a69' }], // 31337 in hex
                });
                
                addResult('âœ… å·²åˆ‡æ¢åˆ° Anvil ç½‘ç»œï¼', true);
                
                // éªŒè¯åˆ‡æ¢
                const chainId = await window.ethereum.request({ 
                    method: 'eth_chainId' 
                });
                addResult(`å½“å‰ Chain ID: ${parseInt(chainId, 16)}`, true);
                
            } catch (error) {
                if (error.code === 4902) {
                    addResult('âš ï¸ Anvil ç½‘ç»œä¸å­˜åœ¨ï¼Œè¯·å…ˆç‚¹å‡» "3. æ·»åŠ  Anvil ç½‘ç»œ"', false);
                } else if (error.code === 4001) {
                    addResult('âš ï¸ ç”¨æˆ·æ‹’ç»äº†åˆ‡æ¢ç½‘ç»œè¯·æ±‚', false);
                } else {
                    addResult(`âŒ åˆ‡æ¢ç½‘ç»œå¤±è´¥: ${error.message}`, false);
                }
            }
        }

        async function connectWallet() {
            resultsDiv.innerHTML = '';
            
            try {
                const accounts = await window.ethereum.request({ 
                    method: 'eth_requestAccounts' 
                });
                
                addResult('âœ… é’±åŒ…è¿æ¥æˆåŠŸï¼', true);
                addResult(`è´¦æˆ·åœ°å€: ${accounts[0]}`, true);
                
                // è·å–ä½™é¢
                const balance = await window.ethereum.request({
                    method: 'eth_getBalance',
                    params: [accounts[0], 'latest']
                });
                const balanceInEth = parseInt(balance, 16) / 1e18;
                addResult(`ä½™é¢: ${balanceInEth.toFixed(4)} ETH`, true);
                
                // è·å– Chain ID
                const chainId = await window.ethereum.request({ 
                    method: 'eth_chainId' 
                });
                addResult(`Chain ID: ${parseInt(chainId, 16)}`, true);
                
            } catch (error) {
                if (error.code === 4001) {
                    addResult('âš ï¸ ç”¨æˆ·æ‹’ç»äº†è¿æ¥è¯·æ±‚', false);
                } else {
                    addResult(`âŒ è¿æ¥å¤±è´¥: ${error.message}`, false);
                }
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥
        window.addEventListener('load', () => {
            setTimeout(checkWallet, 500);
        });
    </script>
</body>
</html>

