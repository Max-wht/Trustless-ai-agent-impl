# è¿æ¥é’±åŒ…æ—¶ 500 é”™è¯¯ - è§£å†³æ–¹æ¡ˆ

## ğŸš¨ é—®é¢˜æè¿°

**é”™è¯¯æ—¥å¿—**:

```json
{"level":30,"res":{"statusCode":500},"responseTime":45.9ms,"msg":"request completed"}
```

**é”™è¯¯åŸå› **:

```
"expected valid r: 1 <= n < 115792089237316195423570985008687907852837564279074904382605163141518161494337, got 0"
```

è¿™æ˜¯**ç­¾åéªŒè¯å¤±è´¥**å¯¼è‡´çš„ 500 é”™è¯¯ã€‚

---

## âœ… å·²å®æ–½çš„ä¿®å¤

### 1. åç«¯æ”¹è¿›

âœ… æ·»åŠ äº†ç­¾åéªŒè¯çš„ try-catch é”™è¯¯å¤„ç†  
âœ… æä¾›æ›´è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯  
âœ… åŒºåˆ†ç­¾åæ ¼å¼é”™è¯¯å’ŒéªŒè¯å¤±è´¥

### 2. å‰ç«¯æ”¹è¿›

âœ… æ·»åŠ ç­¾åè¯·æ±‚çš„é”™è¯¯æ•è·  
âœ… éªŒè¯ç­¾åæ ¼å¼  
âœ… æä¾›ä¸­æ–‡é”™è¯¯æç¤º  
âœ… æ”¹è¿›çš„é”™è¯¯æ—¥å¿—

---

## ğŸ”§ ç«‹å³ä¿®å¤æ­¥éª¤

### æ­¥éª¤ 1: é‡å¯åç«¯æœåŠ¡ï¼ˆå¿…é¡»ï¼ï¼‰

```bash
# åœæ­¢å½“å‰åç«¯æœåŠ¡ï¼ˆCtrl+Cï¼‰

# é‡æ–°å¯åŠ¨
cd /Users/max/code/foundry-code/foundry-trustless-ai-agent
pnpm --filter @trustless/agent-service dev
```

ç­‰å¾…çœ‹åˆ°: `âœ” Agent service listening on http://0.0.0.0:3001`

### æ­¥éª¤ 2: é‡å¯å‰ç«¯æœåŠ¡

```bash
# åœæ­¢å½“å‰å‰ç«¯æœåŠ¡ï¼ˆCtrl+Cï¼‰

# é‡æ–°å¯åŠ¨
cd /Users/max/code/foundry-code/foundry-trustless-ai-agent
pnpm --filter @trustless/web-app dev
```

ç­‰å¾…çœ‹åˆ°: `âœ” Ready in Xs` å’Œ `- Local: http://localhost:3000`

### æ­¥éª¤ 3: æ¸…é™¤æµè§ˆå™¨ç¼“å­˜

**ç¡¬æ€§åˆ·æ–°**:

- Windows/Linux: `Ctrl + Shift + R`
- Mac: `Cmd + Shift + R`

**æˆ–ä½¿ç”¨éšç§/æ— ç—•æ¨¡å¼æµ‹è¯•**

### æ­¥éª¤ 4: é‡æ–°æµ‹è¯•

1. è®¿é—® http://localhost:3000
2. ç‚¹å‡» "Connect Wallet"
3. é€‰æ‹©æ‚¨çš„é’±åŒ…ï¼ˆMetaMask, WalletConnect ç­‰ï¼‰
4. **æ‰¹å‡†è¿æ¥è¯·æ±‚**
5. **æ‰¹å‡†ç­¾åè¯·æ±‚**ï¼ˆé‡è¦ï¼ï¼‰

---

## ğŸ” å¯èƒ½çš„é”™è¯¯åŸå› 

### åŸå›  1: ç”¨æˆ·æ‹’ç»ç­¾å âŒ

**ç—‡çŠ¶**: é’±åŒ…å¼¹çª—å‡ºç°åç‚¹å‡»"æ‹’ç»"æˆ–"å–æ¶ˆ"

**è§£å†³æ–¹æ¡ˆ**:

- é‡æ–°è¿æ¥é’±åŒ…
- è¿™æ¬¡ç‚¹å‡»"ç­¾å"æˆ–"æ‰¹å‡†"
- ç­¾åæ¶ˆæ¯æ˜¯: "Sign in to Trustless SocialFi"

### åŸå›  2: ç­¾åæ ¼å¼æ— æ•ˆ âŒ

**ç—‡çŠ¶**: ç­¾åé•¿åº¦ä¸è¶³æˆ–æ ¼å¼é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**:

- æ›´æ–°é’±åŒ…åˆ°æœ€æ–°ç‰ˆæœ¬
- å°è¯•ä¸åŒçš„é’±åŒ…ï¼ˆMetaMask, Coinbase Wallet ç­‰ï¼‰
- æ£€æŸ¥é’±åŒ…è®¾ç½®

### åŸå›  3: ç½‘ç»œé—®é¢˜ âŒ

**ç—‡çŠ¶**: è¯·æ±‚è¶…æ—¶æˆ–è¿æ¥å¤±è´¥

**è§£å†³æ–¹æ¡ˆ**:

- æ£€æŸ¥åç«¯å’Œ Anvil æ˜¯å¦è¿è¡Œ
- éªŒè¯ç¯å¢ƒå˜é‡é…ç½®
- æŸ¥çœ‹åç«¯æ—¥å¿—

---

## ğŸ“‹ æ£€æŸ¥æ¸…å•

### æœåŠ¡çŠ¶æ€

- [ ] PostgreSQL è¿è¡Œä¸­ (`lsof -i :5432`)
- [ ] Anvil åŒºå—é“¾è¿è¡Œä¸­ (`lsof -i :8545`)
- [ ] åç«¯æœåŠ¡è¿è¡Œä¸­ (`lsof -i :3001`)
- [ ] å‰ç«¯æœåŠ¡è¿è¡Œä¸­ (`lsof -i :3000`)

### ç¯å¢ƒé…ç½®

- [ ] `/packages/agent-service/.env` å­˜åœ¨ä¸”é…ç½®æ­£ç¡®
- [ ] `/packages/web-app/.env.local` å­˜åœ¨ä¸”é…ç½®æ­£ç¡®
- [ ] åˆçº¦å·²éƒ¨ç½² (`cat packages/contracts/deployments.json`)

### æµè§ˆå™¨

- [ ] ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬çš„ Chrome/Firefox/Brave
- [ ] é’±åŒ…æ’ä»¶å·²å®‰è£…å¹¶ç™»å½•
- [ ] æµè§ˆå™¨æ§åˆ¶å°æ— é”™è¯¯ï¼ˆF12ï¼‰

---

## ğŸ§ª è°ƒè¯•æ–¹æ³•

### 1. æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°

æ‰“å¼€å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰â†’ Console æ ‡ç­¾

**æœŸæœ›çœ‹åˆ°çš„æ—¥å¿—**:

```
Signature request successful
Registration API call...
User registered successfully
```

**å¦‚æœçœ‹åˆ°é”™è¯¯**:

```
Signature request error: User rejected the request
ç”¨æˆ·æ‹’ç»ç­¾åæˆ–ç­¾åå¤±è´¥
```

â†’ è¿™æ„å‘³ç€æ‚¨æ‹’ç»äº†ç­¾åè¯·æ±‚

### 2. æŸ¥çœ‹åç«¯æ—¥å¿—

åœ¨åç«¯æœåŠ¡çš„ç»ˆç«¯ä¸­æŸ¥çœ‹æ—¥å¿—

**æ­£å¸¸æ—¥å¿—**:

```json
{"level":30,"msg":"incoming request","req":{...}}
{"level":30,"msg":"request completed","res":{"statusCode":201}}
```

**é”™è¯¯æ—¥å¿—**:

```json
{"level":50,"msg":"Signature verification error"}
{"error":"expected valid r: ..."}
```

### 3. æµ‹è¯•ç­¾ååŠŸèƒ½

åœ¨æµè§ˆå™¨æ§åˆ¶å°æ‰‹åŠ¨æµ‹è¯•:

```javascript
// 1. è·å–è¿æ¥çš„åœ°å€
const accounts = await window.ethereum.request({
  method: 'eth_requestAccounts',
});
console.log('Connected:', accounts[0]);

// 2. è¯·æ±‚ç­¾å
const message = 'Sign in to Trustless SocialFi';
const signature = await window.ethereum.request({
  method: 'personal_sign',
  params: [message, accounts[0]],
});
console.log('Signature:', signature);
console.log('Signature length:', signature.length);

// ç­¾åé•¿åº¦åº”è¯¥æ˜¯ 132 å­—ç¬¦ï¼ˆ0x + 130 ä¸ªåå…­è¿›åˆ¶å­—ç¬¦ï¼‰
```

### 4. ç›´æ¥æµ‹è¯•åç«¯ API

```bash
# ä½¿ç”¨æœ‰æ•ˆçš„ç­¾åæµ‹è¯•ï¼ˆéœ€è¦å…ˆè·å–çœŸå®ç­¾åï¼‰
curl -X POST http://localhost:3001/users/register \
  -H "Content-Type: application/json" \
  -d '{
    "walletAddress": "0xYourAddress",
    "signature": "0xYourSignature",
    "username": "test",
    "bio": "test"
  }'
```

---

## ğŸ’¡ å¸¸è§é—®é¢˜è§£ç­”

### Q: ä¸ºä»€ä¹ˆéœ€è¦ç­¾åï¼Ÿ

**A**: ç­¾åç”¨äºéªŒè¯æ‚¨ç¡®å®æ‹¥æœ‰è¯¥é’±åŒ…åœ°å€ã€‚è¿™æ˜¯ Web3 åº”ç”¨çš„æ ‡å‡†å®‰å…¨æªæ–½ï¼Œç¡®ä¿æ²¡äººèƒ½å†’å……æ‚¨æ³¨å†Œè´¦æˆ·ã€‚

### Q: ç­¾åä¼šèŠ±è´¹ Gas è´¹å—ï¼Ÿ

**A**: âŒ **ä¸ä¼šï¼** ç­¾ååªæ˜¯ä¸€ä¸ªå¯†ç å­¦è¯æ˜ï¼Œä¸ä¼šå‘é€äº¤æ˜“ï¼Œå®Œå…¨å…è´¹ã€‚

### Q: ç­¾åå®‰å…¨å—ï¼Ÿ

**A**: âœ… **å®‰å…¨ï¼** ç­¾ååªè¯æ˜æ‚¨æ‹¥æœ‰è¯¥åœ°å€ï¼Œä¸ä¼šæˆæƒä»»ä½•èµ„é‡‘è½¬ç§»ã€‚æ¶ˆæ¯å†…å®¹æ˜¯æ˜æ–‡çš„ "Sign in to Trustless SocialFi"ã€‚

### Q: ä¸ºä»€ä¹ˆè¿˜ä¼šæœ‰åŒºå—é“¾äº¤æ˜“ï¼Ÿ

**A**: åœ¨ç­¾åéªŒè¯é€šè¿‡åï¼Œåç«¯ä¼šè°ƒç”¨æ™ºèƒ½åˆçº¦åœ¨é“¾ä¸Šæ³¨å†Œæ‚¨çš„è´¦æˆ·ã€‚è¿™ä¸ªäº¤æ˜“ç”±åç«¯æ”¯ä»˜ Gas è´¹ï¼Œæ‚¨æ— éœ€æ”¯ä»˜ã€‚

### Q: å¯ä»¥è·³è¿‡ç­¾åå—ï¼Ÿ

**A**: åœ¨ç”Ÿäº§ç¯å¢ƒä¸å¯ä»¥ï¼Œè¿™æ˜¯å®‰å…¨å¿…éœ€çš„ã€‚ä½†å¦‚æœæ‚¨æ˜¯å¼€å‘è€…ï¼Œå¯ä»¥åœ¨å¼€å‘ç¯å¢ƒä¸´æ—¶ç¦ç”¨ç­¾åéªŒè¯ï¼ˆä¸æ¨èï¼‰ã€‚

---

## ğŸ”§ é«˜çº§è°ƒè¯•

### æŸ¥çœ‹å®Œæ•´çš„è¯·æ±‚/å“åº”

åœ¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼š

1. Network æ ‡ç­¾
2. æ‰¾åˆ° `/users/register` è¯·æ±‚
3. æŸ¥çœ‹ Request Payload å’Œ Response

**æ­£å¸¸è¯·æ±‚**:

```json
{
  "walletAddress": "0x...",
  "signature": "0x... (132 å­—ç¬¦)",
  "username": "",
  "bio": ""
}
```

**æ­£å¸¸å“åº” (201)**:

```json
{
  "success": true,
  "user": {...},
  "txHash": "0x..."
}
```

**é”™è¯¯å“åº” (400/500)**:

```json
{
  "error": "Signature verification failed",
  "details": "expected valid r: ..."
}
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [æœåŠ¡é‡å¯æŒ‡å—](./RESTART-SERVICES.md)
- [CORS é—®é¢˜ä¿®å¤](./QUICK-FIX-CORS.md)
- [Story 1.7 æµ‹è¯•æŒ‡å—](./stories/story-1.7-testing-guide.md)

---

## ğŸ†˜ ä»ç„¶æ— æ³•è§£å†³ï¼Ÿ

å¦‚æœæŒ‰ç…§ä»¥ä¸Šæ­¥éª¤ä»æœ‰é—®é¢˜ï¼Œè¯·æä¾›ï¼š

1. **æµè§ˆå™¨æ§åˆ¶å°å®Œæ•´æ—¥å¿—**ï¼ˆæˆªå›¾ï¼‰
2. **Network æ ‡ç­¾ä¸­çš„è¯·æ±‚è¯¦æƒ…**ï¼ˆæˆªå›¾ï¼‰
3. **åç«¯æ§åˆ¶å°æ—¥å¿—**ï¼ˆæ–‡æœ¬ï¼‰
4. **ä½¿ç”¨çš„é’±åŒ…å’Œç‰ˆæœ¬**
5. **ç­¾åæµ‹è¯•çš„ç»“æœ**

---

**ä¿®å¤å®Œæˆæ—¶é—´**: 2025-10-11  
**çŠ¶æ€**: âœ… é”™è¯¯å¤„ç†å·²æ”¹è¿›ï¼Œè¯·é‡å¯æœåŠ¡æµ‹è¯•
