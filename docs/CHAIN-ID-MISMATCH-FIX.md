# Chain ID ä¸åŒ¹é…é—®é¢˜ - è§£å†³æ–¹æ¡ˆ

## ğŸš¨ é—®é¢˜æè¿°

**é”™è¯¯ä¿¡æ¯**:

```
does not match the target chain for the transaction
Current Chain ID: 31337
Expected Chain ID: 1337 â€“ Localhost
```

**é—®é¢˜åŸå› **:

- Anvil ä½¿ç”¨ Chain ID **31337**
- é’±åŒ…é»˜è®¤è¿æ¥åˆ° Chain ID **1337**ï¼ˆæ ‡å‡† localhostï¼‰
- å‰ç«¯é…ç½®ä¸­æ²¡æœ‰ Anvil æœ¬åœ°é“¾

---

## âœ… å·²å®æ–½çš„ä¿®å¤

### ä¿®æ”¹çš„æ–‡ä»¶

`packages/web-app/src/lib/wagmi.ts`

### ä¸»è¦æ›´æ”¹

1. âœ… **å®šä¹‰ Anvil æœ¬åœ°é“¾**
   - Chain ID: 31337
   - RPC URL: http://127.0.0.1:8545

2. âœ… **æ·»åŠ åˆ°é“¾é…ç½®**
   - å°† Anvil é“¾æ·»åŠ åˆ°æ”¯æŒçš„é“¾åˆ—è¡¨
   - é…ç½®å¯¹åº”çš„ RPC transport

3. âœ… **ä¿ç•™æµ‹è¯•ç½‘æ”¯æŒ**
   - åŒæ—¶æ”¯æŒ Anvil å’Œ Arbitrum Sepolia
   - æ–¹ä¾¿åœ¨æœ¬åœ°å’Œæµ‹è¯•ç½‘ä¹‹é—´åˆ‡æ¢

---

## ğŸ”§ ç«‹å³ä¿®å¤æ­¥éª¤

### æ­¥éª¤ 1: é‡å¯å‰ç«¯æœåŠ¡

å‰ç«¯é…ç½®å·²æ›´æ–°ï¼Œéœ€è¦é‡å¯æ‰èƒ½ç”Ÿæ•ˆï¼š

```bash
# åœæ­¢å½“å‰å‰ç«¯æœåŠ¡ï¼ˆCtrl+Cï¼‰

cd /Users/max/code/foundry-code/foundry-trustless-ai-agent
pnpm --filter @trustless/web-app dev
```

### æ­¥éª¤ 2: æ¸…é™¤æµè§ˆå™¨ç¼“å­˜

**ç¡¬æ€§åˆ·æ–°**:

- Windows/Linux: `Ctrl + Shift + R`
- Mac: `Cmd + Shift + R`

**æˆ–ä½¿ç”¨æ— ç—•æ¨¡å¼æµ‹è¯•**

### æ­¥éª¤ 3: åœ¨é’±åŒ…ä¸­åˆ‡æ¢ç½‘ç»œ

#### æ–¹æ³• A: ä½¿ç”¨ RainbowKit åˆ‡æ¢ï¼ˆæ¨èï¼‰

1. è¿æ¥é’±åŒ…åï¼Œåœ¨é¡µé¢å³ä¸Šè§’æ‰¾åˆ°ç½‘ç»œé€‰æ‹©å™¨
2. ç‚¹å‡»å½“å‰ç½‘ç»œåç§°
3. é€‰æ‹© **"Anvil"** (Chain ID: 31337)
4. ç¡®è®¤åˆ‡æ¢

#### æ–¹æ³• B: åœ¨ MetaMask ä¸­æ‰‹åŠ¨æ·»åŠ ç½‘ç»œ

1. æ‰“å¼€ MetaMask
2. ç‚¹å‡»é¡¶éƒ¨çš„ç½‘ç»œä¸‹æ‹‰èœå•
3. ç‚¹å‡» "æ·»åŠ ç½‘ç»œ" â†’ "æ‰‹åŠ¨æ·»åŠ ç½‘ç»œ"
4. å¡«å†™ä»¥ä¸‹ä¿¡æ¯ï¼š

```
ç½‘ç»œåç§°: Anvil Local
RPC URL: http://127.0.0.1:8545
Chain ID: 31337
è´§å¸ç¬¦å·: ETH
```

5. ç‚¹å‡»ä¿å­˜
6. åˆ‡æ¢åˆ° Anvil Local ç½‘ç»œ

### æ­¥éª¤ 4: é‡æ–°è¿æ¥é’±åŒ…

1. è®¿é—® http://localhost:3000
2. ç‚¹å‡» "Connect Wallet"
3. é€‰æ‹©æ‚¨çš„é’±åŒ…
4. **ç¡®è®¤å½“å‰ç½‘ç»œæ˜¯ "Anvil" (31337)**
5. æ‰¹å‡†è¿æ¥
6. æ‰¹å‡†ç­¾å

---

## ğŸ” éªŒè¯ä¿®å¤

### æ£€æŸ¥å½“å‰ç½‘ç»œ

åœ¨æµè§ˆå™¨æ§åˆ¶å°ï¼ˆF12ï¼‰è¿è¡Œï¼š

```javascript
// æ£€æŸ¥è¿æ¥çš„é“¾ ID
const chainId = await window.ethereum.request({ method: 'eth_chainId' });
console.log('Chain ID:', parseInt(chainId, 16));
// åº”è¯¥æ˜¾ç¤º: Chain ID: 31337
```

### æ£€æŸ¥é’±åŒ…è´¦æˆ·

```javascript
// è·å–è´¦æˆ·
const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
console.log('Connected:', accounts[0]);
// åº”è¯¥æ˜¾ç¤ºæ‚¨çš„é’±åŒ…åœ°å€
```

---

## ğŸ“‹ Chain ID å¯¹ç…§è¡¨

| ç½‘ç»œ             | Chain ID | ç”¨é€”           |
| ---------------- | -------- | -------------- |
| Anvil            | 31337    | æœ¬åœ°å¼€å‘ âœ…    |
| Localhost        | 1337     | å…¶ä»–æœ¬åœ°èŠ‚ç‚¹   |
| Ethereum Mainnet | 1        | ç”Ÿäº§ç¯å¢ƒ       |
| Sepolia          | 11155111 | æµ‹è¯•ç½‘         |
| Arbitrum One     | 42161    | Layer 2 ä¸»ç½‘   |
| Arbitrum Sepolia | 421614   | Layer 2 æµ‹è¯•ç½‘ |

---

## ğŸš¨ å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆ Anvil ä½¿ç”¨ 31337ï¼Ÿ

**A**: è¿™æ˜¯ Foundry/Anvil çš„é»˜è®¤ Chain IDã€‚

- âœ… 31337 = "ELEET" (1337 çš„å˜ä½“ï¼Œé»‘å®¢æ–‡åŒ–)
- âœ… é¿å…ä¸å…¶ä»–æœ¬åœ°èŠ‚ç‚¹å†²çª
- âœ… Foundry ç”Ÿæ€ç³»ç»Ÿçš„æ ‡å‡†

### Q2: å¯ä»¥æ”¹æˆ 1337 å—ï¼Ÿ

**A**: å¯ä»¥ï¼Œä½†ä¸æ¨èã€‚

**å¦‚æœéè¦æ”¹**:

```bash
# å¯åŠ¨ Anvil æ—¶æŒ‡å®š Chain ID
anvil --chain-id 1337
```

ç„¶åéœ€è¦åŒæ­¥ä¿®æ”¹å‰ç«¯é…ç½®ã€‚

### Q3: é’±åŒ…æ˜¾ç¤ºç½‘ç»œä¸åŒ¹é…æ€ä¹ˆåŠï¼Ÿ

**A**:

1. ç¡®è®¤å‰ç«¯å·²é‡å¯
2. åœ¨é’±åŒ…ä¸­åˆ‡æ¢åˆ° Anvil ç½‘ç»œ
3. æ–­å¼€å¹¶é‡æ–°è¿æ¥é’±åŒ…

### Q4: çœ‹ä¸åˆ° Anvil ç½‘ç»œé€‰é¡¹

**A**:

1. ç¡®è®¤å‰ç«¯å·²é‡å¯ï¼ˆåº”ç”¨æœ€æ–°é…ç½®ï¼‰
2. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜
3. æ‰‹åŠ¨åœ¨ MetaMask ä¸­æ·»åŠ ç½‘ç»œ

### Q5: éƒ¨ç½²çš„åˆçº¦åœ¨å“ªä¸ªé“¾ä¸Šï¼Ÿ

**A**: æŸ¥çœ‹éƒ¨ç½²è¾“å‡ºï¼š

```bash
cd packages/contracts
cat deployments.json
```

åº”è¯¥æ˜¾ç¤ºï¼š

```json
{
  "31337": {
    "chainName": "Anvil Local",
    "contracts": {
      "UserRegistry": "0x..."
    }
  }
}
```

---

## ğŸ”§ æ•…éšœæ’æŸ¥

### é—®é¢˜ 1: å‰ç«¯æ˜¾ç¤º "Unsupported Chain"

**åŸå› **: é’±åŒ…è¿æ¥åˆ°äº†ä¸æ”¯æŒçš„ç½‘ç»œ

**è§£å†³æ–¹æ¡ˆ**:

1. åœ¨é’±åŒ…ä¸­åˆ‡æ¢åˆ° Anvil (31337)
2. æˆ–åœ¨é¡µé¢ä¸Šç‚¹å‡» "Switch Network" æŒ‰é’®

### é—®é¢˜ 2: åˆ‡æ¢ç½‘ç»œåä»ç„¶æŠ¥é”™

**è§£å†³æ–¹æ¡ˆ**:

1. æ–­å¼€é’±åŒ…è¿æ¥
2. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜
3. é‡æ–°è¿æ¥é’±åŒ…

### é—®é¢˜ 3: MetaMask ä¸­çœ‹ä¸åˆ° Anvil ç½‘ç»œ

**è§£å†³æ–¹æ¡ˆ**:

æ‰‹åŠ¨æ·»åŠ ç½‘ç»œï¼ˆå‚è€ƒæ­¥éª¤ 3 - æ–¹æ³• Bï¼‰

### é—®é¢˜ 4: RPC è¿æ¥å¤±è´¥

**æ£€æŸ¥æ¸…å•**:

- [ ] Anvil æ­£åœ¨è¿è¡Œ: `lsof -i :8545`
- [ ] RPC URL æ­£ç¡®: `http://127.0.0.1:8545`
- [ ] é˜²ç«å¢™å…è®¸æœ¬åœ°è¿æ¥
- [ ] æµ‹è¯• RPC: `curl http://127.0.0.1:8545`

---

## ğŸ’¡ å¼€å‘æœ€ä½³å®è·µ

### æœ¬åœ°å¼€å‘

1. **å§‹ç»ˆä½¿ç”¨ Anvil (31337)**

   ```bash
   ./start-dev.sh  # è‡ªåŠ¨å¯åŠ¨å¹¶é…ç½®
   ```

2. **åœ¨é’±åŒ…ä¸­ä¿å­˜ Anvil ç½‘ç»œ**
   - æ–¹ä¾¿å¿«é€Ÿåˆ‡æ¢
   - é¿å…æ¯æ¬¡æ‰‹åŠ¨æ·»åŠ 

3. **ä½¿ç”¨ Anvil é»˜è®¤è´¦æˆ·**
   - åœ°å€: `0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266`
   - ç§é’¥: `0xac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80`
   - ä½™é¢: 10000 ETH

### æµ‹è¯•ç½‘å¼€å‘

1. **åˆ‡æ¢åˆ° Arbitrum Sepolia**
   - åœ¨é’±åŒ…ä¸­é€‰æ‹© Arbitrum Sepolia
   - è·å–æµ‹è¯• ETH: https://faucet.arbitrum.io/

2. **æ›´æ–°åˆçº¦åœ°å€**
   - éƒ¨ç½²åˆ°æµ‹è¯•ç½‘åæ›´æ–° `deployments.json`

### ç”Ÿäº§ç¯å¢ƒ

1. **ä½¿ç”¨çœŸå®ç½‘ç»œ**
   - Ethereum Mainnet æˆ– Arbitrum One
   - æ›´æ–° `wagmi.ts` é…ç½®

2. **ç§»é™¤æœ¬åœ°é“¾**
   - ç”Ÿäº§ç¯å¢ƒä¸åº”åŒ…å« Anvil é“¾é…ç½®

---

## ğŸ“Š ç½‘ç»œé…ç½®å¯¹æ¯”

### å¼€å‘ç¯å¢ƒ (å½“å‰)

```typescript
chains: [anvil, arbitrumSepolia];
```

**ä¼˜ç‚¹**:

- âœ… æ”¯æŒæœ¬åœ°å¼€å‘
- âœ… æ”¯æŒæµ‹è¯•ç½‘æµ‹è¯•
- âœ… çµæ´»åˆ‡æ¢

### æµ‹è¯•ç¯å¢ƒ

```typescript
chains: [arbitrumSepolia];
```

**ä¼˜ç‚¹**:

- âœ… çœŸå®ç½‘ç»œç¯å¢ƒ
- âœ… æµ‹è¯•é’±åŒ…é›†æˆ
- âœ… æµ‹è¯• Gas è´¹ç”¨

### ç”Ÿäº§ç¯å¢ƒ

```typescript
chains: [arbitrum, mainnet];
```

**ä¼˜ç‚¹**:

- âœ… ä¸»ç½‘éƒ¨ç½²
- âœ… çœŸå®ç”¨æˆ·
- âœ… çœŸå®èµ„äº§

---

## ğŸ¯ å¿«é€Ÿæ£€æŸ¥å‘½ä»¤

### æ£€æŸ¥ Anvil çŠ¶æ€

```bash
# æ£€æŸ¥ Anvil æ˜¯å¦è¿è¡Œ
lsof -i :8545

# æµ‹è¯• RPC è¿æ¥
curl -X POST http://127.0.0.1:8545 \
  -H "Content-Type: application/json" \
  --data '{"jsonrpc":"2.0","method":"eth_chainId","params":[],"id":1}'

# åº”è¯¥è¿”å›: {"jsonrpc":"2.0","id":1,"result":"0x7a69"}
# 0x7a69 (hex) = 31337 (decimal)
```

### æ£€æŸ¥å‰ç«¯é…ç½®

```bash
# æŸ¥çœ‹ç¼–è¯‘åçš„é…ç½®
cd packages/web-app
grep -r "31337" .next/
```

### æ£€æŸ¥é’±åŒ…ç½‘ç»œ

åœ¨æµè§ˆå™¨æ§åˆ¶å°ï¼š

```javascript
window.ethereum
  .request({ method: 'eth_chainId' })
  .then((chainId) => console.log('Current Chain:', parseInt(chainId, 16)));
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [RainbowKit - Custom Chains](https://www.rainbowkit.com/docs/custom-chains)
- [Viem - Chains](https://viem.sh/docs/chains/introduction.html)
- [Anvil æ–‡æ¡£](https://book.getfoundry.sh/anvil/)
- [å¼€å‘è„šæœ¬ä½¿ç”¨](./DEV-SCRIPTS-USAGE.md)

---

## ğŸ‰ æ€»ç»“

**é—®é¢˜**: Chain ID ä¸åŒ¹é…ï¼ˆ1337 vs 31337ï¼‰

**è§£å†³æ–¹æ¡ˆ**:

1. âœ… åœ¨å‰ç«¯æ·»åŠ  Anvil é“¾é…ç½®ï¼ˆChain ID: 31337ï¼‰
2. âœ… é‡å¯å‰ç«¯æœåŠ¡
3. âœ… åœ¨é’±åŒ…ä¸­åˆ‡æ¢åˆ° Anvil ç½‘ç»œ
4. âœ… é‡æ–°è¿æ¥é’±åŒ…

**ç»“æœ**: å¯ä»¥æ­£å¸¸è¿æ¥å’Œä½¿ç”¨ Anvil æœ¬åœ°ç½‘ç»œï¼

---

**ä¿®å¤å®Œæˆæ—¶é—´**: 2025-10-11  
**çŠ¶æ€**: âœ… Chain ID é…ç½®å·²ä¿®å¤  
**ä¸‹ä¸€æ­¥**: é‡å¯å‰ç«¯å¹¶åˆ‡æ¢é’±åŒ…ç½‘ç»œ
