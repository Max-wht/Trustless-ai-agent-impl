# Epic 2: Token Economy & Agent Registration

## Epic Goal

å®ç° Trustless SocialFi çš„åŸç”Ÿä»£å¸ç»æµæ¨¡å‹å’Œ Agent æ³¨å†Œç³»ç»Ÿã€‚éƒ¨ç½² ERC-20 ä»£å¸åˆçº¦ï¼ˆå›ºå®šæ€»é‡ã€æ”¯æŒè´¨æŠ¼ï¼‰ï¼Œå®ç° Agent æ³¨å†Œæ™ºèƒ½åˆçº¦ï¼ˆè´¨æŠ¼æœºåˆ¶ã€Agent ä¿¡æ¯å­˜å‚¨ï¼‰ï¼Œå¼€å‘ Agent åˆ—è¡¨å‰ç«¯ç•Œé¢ï¼ˆå±•ç¤ºæ‰€æœ‰æ³¨å†Œ Agent åŠå…¶ä¿¡èª‰çŠ¶æ€ï¼‰ã€‚æ­¤ Epic å®Œæˆåï¼ŒAgent å¯ä»¥è´¨æŠ¼ä»£å¸æ³¨å†Œï¼Œç”¨æˆ·å¯ä»¥æŸ¥çœ‹ Agent ç½‘ç»œçŠ¶æ€ï¼Œä¸º Epic 4 çš„å†…å®¹å®¡æ ¸ç³»ç»Ÿå¥ å®šåŸºç¡€ã€‚

## Story 2.1: ERC-20 ä»£å¸åˆçº¦å¼€å‘ä¸éƒ¨ç½²

As a **æ™ºèƒ½åˆçº¦å¼€å‘è€…**,  
I want **å¼€å‘ç¬¦åˆ ERC-20 æ ‡å‡†çš„åŸç”Ÿä»£å¸åˆçº¦ï¼ˆTrustToken - $TRUSTï¼‰ï¼Œå›ºå®šæ€»é‡ 1 äº¿ï¼Œæ”¯æŒè½¬è´¦ã€æˆæƒã€è´¨æŠ¼åŠŸèƒ½**,  
so that **ä»£å¸å¯ä»¥ç”¨äº Agent è´¨æŠ¼ã€DAO æ²»ç†æŠ•ç¥¨ã€åˆ›ä½œè€…å¥–åŠ±ï¼Œæ˜¯æ•´ä¸ªç»æµæ¨¡å‹çš„åŸºç¡€**ã€‚

### Acceptance Criteria

1. åˆ›å»ºåˆçº¦ `src/TrustToken.sol`ï¼Œç»§æ‰¿ `@openzeppelin/contracts/token/ERC20/ERC20.sol`
2. æ„é€ å‡½æ•°ï¼šé“¸é€  1 äº¿ä»£å¸ï¼ˆ100,000,000 \* 10^18ï¼‰åˆ°éƒ¨ç½²è€…åœ°å€
3. å®ç°ä»£å¸ä¿¡æ¯ï¼šåç§° "TrustToken"ã€ç¬¦å· "$TRUST"ã€å°æ•°ä½ 18
4. ç»§æ‰¿ `ERC20Burnable`ï¼ˆæ”¯æŒé”€æ¯ï¼‰ã€`Ownable`ï¼ˆæ‰€æœ‰æƒç®¡ç†ï¼‰
5. ç¼–å†™å®Œæ•´æµ‹è¯• `test/TrustToken.t.sol`ï¼š
   - æµ‹è¯•æ€»é‡æ­£ç¡®ï¼ˆ1 äº¿ï¼‰
   - æµ‹è¯•è½¬è´¦åŠŸèƒ½
   - æµ‹è¯•æˆæƒå’Œ transferFrom
   - æµ‹è¯•é”€æ¯åŠŸèƒ½
   - æµ‹è¯•æ‰€æœ‰æƒè½¬ç§»
6. è¿è¡Œ `forge test` æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼Œè¦†ç›–ç‡ > 90%
7. è¿è¡Œ `forge coverage` æ£€æŸ¥è¦†ç›–ç‡
8. åˆ›å»ºéƒ¨ç½²è„šæœ¬ `script/DeployTrustToken.s.sol`
9. éƒ¨ç½²åˆ°æœ¬åœ° Anvilï¼ŒéªŒè¯éƒ¨ç½²æˆåŠŸ
10. ä½¿ç”¨ `cast` å‘½ä»¤æŸ¥è¯¢ä»£å¸ä¿¡æ¯ï¼ˆnameã€symbolã€totalSupplyï¼‰æ­£ç¡®
11. åœ¨ `packages/shared/src/constants/contracts.ts` æ·»åŠ ä»£å¸åœ°å€

## Story 2.2: Agent æ³¨å†Œæ™ºèƒ½åˆçº¦å¼€å‘

As a **æ™ºèƒ½åˆçº¦å¼€å‘è€…**,  
I want **å¼€å‘ Agent æ³¨å†Œåˆçº¦ï¼ˆAgentRegistryï¼‰ï¼Œå…è®¸ä»»ä½•äººè´¨æŠ¼æœ€ä½ 1000 $TRUST ä»£å¸æ³¨å†Œæˆä¸º Agentï¼Œè®°å½• Agent ä¿¡æ¯å’Œè´¨æŠ¼é‡‘é¢**,  
so that **Agent å¯ä»¥åŠ å…¥å®¡æ ¸ç½‘ç»œï¼Œè´¨æŠ¼æœºåˆ¶ç¡®ä¿ Agent æœ‰ç»æµåŠ¨æœºè¯šå®å®¡æ ¸**ã€‚

### Acceptance Criteria

1. åˆ›å»ºåˆçº¦ `src/AgentRegistry.sol`
2. å®šä¹‰ struct Agentï¼š
   - address agentAddress
   - string serviceEndpointï¼ˆAgent æœåŠ¡çš„ API ç«¯ç‚¹ï¼‰
   - uint256 stakedAmountï¼ˆè´¨æŠ¼é‡‘é¢ï¼‰
   - uint256 reputationScoreï¼ˆä¿¡èª‰è¯„åˆ†ï¼Œåˆå§‹ 50ï¼‰
   - uint256 registeredAtï¼ˆæ³¨å†Œæ—¶é—´ï¼‰
   - bool isActiveï¼ˆæ˜¯å¦æ´»è·ƒï¼‰
3. å®ç°å‡½æ•° `registerAgent(string memory serviceEndpoint)`ï¼š
   - è¦æ±‚è°ƒç”¨è€…æˆæƒåˆçº¦è‡³å°‘ 1000 $TRUSTï¼ˆä½¿ç”¨ `transferFrom`ï¼‰
   - ä»è°ƒç”¨è€…åœ°å€è½¬ç§»ä»£å¸åˆ°åˆçº¦
   - åˆ›å»º Agent è®°å½•
   - è§¦å‘äº‹ä»¶ `AgentRegistered(address indexed agent, uint256 stakedAmount)`
4. å®ç°å‡½æ•° `getAgent(address agentAddress)` è¿”å› Agent ä¿¡æ¯
5. å®ç°å‡½æ•° `getAllAgents()` è¿”å›æ‰€æœ‰æ³¨å†Œ Agent çš„åœ°å€æ•°ç»„
6. å®ç°å‡½æ•° `isActiveAgent(address)` æ£€æŸ¥ Agent æ˜¯å¦æ´»è·ƒ
7. å®ç°å‡½æ•° `updateServiceEndpoint(string memory newEndpoint)`ï¼ˆAgent å¯æ›´æ–°ç«¯ç‚¹ï¼‰
8. å®ç°å‡½æ•° `deactivateAgent()`ï¼ˆAgent å¯åœç”¨ï¼Œä½†ä¸å–å›è´¨æŠ¼é‡‘ï¼Œéœ€è¦ DAO æ‰¹å‡†ï¼‰
9. ç¼–å†™å®Œæ•´æµ‹è¯• `test/AgentRegistry.t.sol`ï¼š
   - æµ‹è¯•æˆåŠŸæ³¨å†Œï¼ˆè´¨æŠ¼ 1000 ä»£å¸ï¼‰
   - æµ‹è¯•è´¨æŠ¼ä¸è¶³å¤±è´¥ï¼ˆ< 1000 ä»£å¸ï¼‰
   - æµ‹è¯•æœªæˆæƒå¤±è´¥
   - æµ‹è¯•æ›´æ–°ç«¯ç‚¹
   - æµ‹è¯•åœç”¨ Agent
10. è¿è¡Œ `forge test` æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼Œè¦†ç›–ç‡ > 90%
11. éƒ¨ç½²åˆ°æœ¬åœ° Anvilï¼ŒéªŒè¯éƒ¨ç½²æˆåŠŸ
12. åœ¨ `packages/shared/src/constants/contracts.ts` æ·»åŠ  AgentRegistry åœ°å€

## Story 2.3: åç«¯ Agent ä¿¡æ¯æŸ¥è¯¢ API

As a **åç«¯å¼€å‘è€…**,  
I want **å®ç° API ç«¯ç‚¹æŸ¥è¯¢æ³¨å†Œçš„ Agent ä¿¡æ¯ï¼ˆä»æ™ºèƒ½åˆçº¦è¯»å–ï¼‰ï¼Œå¹¶ç¼“å­˜åˆ°æ•°æ®åº“æé«˜æŸ¥è¯¢æ•ˆç‡**,  
so that **å‰ç«¯å¯ä»¥å¿«é€Ÿè·å–æ‰€æœ‰ Agent åˆ—è¡¨å’Œè¯¦æƒ…ï¼Œæ— éœ€ç›´æ¥è°ƒç”¨æ™ºèƒ½åˆçº¦**ã€‚

### Acceptance Criteria

1. å®‰è£… viemï¼š`pnpm add viem`
2. åœ¨ `src/lib/web3.ts` åˆ›å»º viem Clientï¼ˆè¿æ¥ Arbitrum Sepoliaï¼‰
3. å¯¼å…¥ AgentRegistry åˆçº¦ ABIï¼ˆä» Foundry ç¼–è¯‘è¾“å‡ºå¤åˆ¶ï¼‰
4. å®ç°å‡½æ•° `fetchAgentsFromChain()`ï¼šè°ƒç”¨åˆçº¦ `getAllAgents()`ï¼Œéå†è·å–æ¯ä¸ª Agent è¯¦æƒ…
5. åˆ›å»º Prisma schemaï¼šAgent è¡¨ï¼ˆidã€walletAddressã€serviceEndpointã€stakedAmountã€reputationScoreã€registeredAtã€isActiveï¼‰
6. å®ç°å‡½æ•° `syncAgentsToDb()`ï¼šä»é“¾ä¸Šè¯»å– Agentï¼ŒåŒæ­¥åˆ°æ•°æ®åº“ï¼ˆupsertï¼‰
7. å®ç° API ç«¯ç‚¹ `GET /agents`ï¼š
   - ä»æ•°æ®åº“æŸ¥è¯¢æ‰€æœ‰ Agentï¼ˆPrismaï¼‰
   - æ”¯æŒåˆ†é¡µï¼ˆquery params: pageã€limitï¼‰
   - æ”¯æŒæ’åºï¼ˆby: reputationScore descï¼‰
   - è¿”å› Agent åˆ—è¡¨
8. å®ç° API ç«¯ç‚¹ `GET /agents/:address`ï¼šè¿”å›å•ä¸ª Agent è¯¦æƒ…
9. åˆ›å»ºå®šæ—¶ä»»åŠ¡ï¼ˆä½¿ç”¨ Bullï¼‰ï¼šæ¯ 5 åˆ†é’Ÿè¿è¡Œ `syncAgentsToDb()`ï¼ˆä¿æŒæ•°æ®åº“ä¸é“¾ä¸ŠåŒæ­¥ï¼‰
10. æµ‹è¯•ï¼šæ³¨å†Œä¸€ä¸ª Agentï¼ˆé€šè¿‡æ™ºèƒ½åˆçº¦ï¼‰ï¼Œ5 åˆ†é’Ÿåæ•°æ®åº“è‡ªåŠ¨åŒæ­¥
11. æµ‹è¯•ï¼šè°ƒç”¨ `GET /agents` è¿”å›æ­£ç¡®çš„ Agent åˆ—è¡¨

## Story 2.4: Agent åˆ—è¡¨é¡µé¢å‰ç«¯å®ç°

As a **ç”¨æˆ·**,  
I want **è®¿é—® Agent åˆ—è¡¨é¡µé¢ï¼ŒæŸ¥çœ‹æ‰€æœ‰æ³¨å†Œçš„ Agentï¼ˆåœ°å€ã€ä¿¡èª‰è¯„åˆ†ã€è´¨æŠ¼é‡‘é¢ã€æ³¨å†Œæ—¶é—´ï¼‰ï¼ŒæŒ‰ä¿¡èª‰è¯„åˆ†æ’åº**,  
so that **æˆ‘å¯ä»¥äº†è§£å“ªäº› Agent åœ¨å®ˆæŠ¤å¹³å°å†…å®¹è´¨é‡ï¼Œé€‰æ‹©ä¿¡ä»»åº¦é«˜çš„ Agentï¼ˆä¸º Phase 2 æ¨èç³»ç»Ÿå‡†å¤‡ï¼‰**ã€‚

### Acceptance Criteria

1. åˆ›å»ºé¡µé¢ `app/agents/page.tsx`
2. è°ƒç”¨åç«¯ API `GET /agents`ï¼Œè·å– Agent åˆ—è¡¨
3. ä½¿ç”¨ shadcn Table ç»„ä»¶å±•ç¤º Agent åˆ—è¡¨ï¼š
   - åˆ—ï¼šAgent åœ°å€ï¼ˆå¯ç‚¹å‡»å¤åˆ¶ï¼‰ã€ä¿¡èª‰è¯„åˆ†ã€è´¨æŠ¼é‡‘é¢ã€æ³¨å†Œæ—¶é—´ã€çŠ¶æ€ï¼ˆæ´»è·ƒ/åœç”¨ï¼‰
   - é»˜è®¤æŒ‰ä¿¡èª‰è¯„åˆ†é™åºæ’åº
   - æ”¯æŒç‚¹å‡»åˆ—å¤´åˆ‡æ¢æ’åºï¼ˆä¿¡èª‰ã€è´¨æŠ¼é‡‘é¢ã€æ—¶é—´ï¼‰
4. å®ç°åˆ†é¡µï¼ˆæ¯é¡µ 20 ä¸ª Agentï¼‰ï¼š
   - ä½¿ç”¨ shadcn Pagination ç»„ä»¶
   - é¡µç åˆ‡æ¢æ—¶è°ƒç”¨ APIï¼ˆ`?page=2&limit=20`ï¼‰
5. å®ç°ç­›é€‰ï¼ˆshadcn Select ç»„ä»¶ï¼‰ï¼š
   - ç­›é€‰æ´»è·ƒ Agent / æ‰€æœ‰ Agent
   - ç­›é€‰é«˜ä¿¡èª‰ï¼ˆ> 80ï¼‰/ ä¸­ä¿¡èª‰ï¼ˆ50-80ï¼‰/ ä½ä¿¡èª‰ï¼ˆ< 50ï¼‰
6. ç‚¹å‡» Agent åœ°å€ï¼Œè·³è½¬åˆ° Agent è¯¦æƒ…é¡µï¼ˆ`/agents/[address]`ï¼Œæš‚æ—¶æ˜¾ç¤ºå ä½å†…å®¹ï¼‰
7. æ˜¾ç¤º Agent æ€»æ•°ç»Ÿè®¡ï¼ˆ"å…± 32 ä¸ª Agent å®ˆæŠ¤å¹³å°"ï¼‰
8. å“åº”å¼è®¾è®¡ï¼šç§»åŠ¨ç«¯ä½¿ç”¨ Card åˆ—è¡¨ï¼ˆè€Œé Tableï¼‰
9. åŠ è½½çŠ¶æ€ï¼šæ˜¾ç¤º Skeleton Table
10. ç©ºçŠ¶æ€ï¼šæ—  Agent æ—¶æ˜¾ç¤º"æš‚æ— æ³¨å†Œ Agentï¼Œæˆä¸ºç¬¬ä¸€ä¸ªï¼"
11. é¡µé¢æ€§èƒ½ï¼šåŠ è½½ 100 ä¸ª Agent < 1 ç§’

## Story 2.5: Agent æ³¨å†Œç•Œé¢ï¼ˆå‰ç«¯è¡¨å•ï¼‰

As a **æ½œåœ¨ Agent è¿è¥è€…**,  
I want **è®¿é—® Agent æ³¨å†Œé¡µé¢ï¼Œå¡«å†™ Agent æœåŠ¡ç«¯ç‚¹ï¼Œæˆæƒä»£å¸è´¨æŠ¼ï¼Œæäº¤æ³¨å†Œäº¤æ˜“**,  
so that **æˆ‘å¯ä»¥æˆä¸ºå®¡æ ¸ç½‘ç»œçš„ä¸€éƒ¨åˆ†ï¼Œé€šè¿‡è¯šå®å®¡æ ¸è·å¾—ä»£å¸å¥–åŠ±**ã€‚

### Acceptance Criteria

1. åˆ›å»ºé¡µé¢ `app/agents/register/page.tsx`
2. ä½¿ç”¨ React Hook Form + Zod åˆ›å»ºè¡¨å•ï¼š
   - å­—æ®µï¼šService Endpointï¼ˆURLï¼Œå¿…å¡«ï¼‰
   - éªŒè¯ï¼šURL æ ¼å¼æ­£ç¡®ï¼ˆhttps://ï¼‰ã€ç«¯ç‚¹å¯è®¿é—®ï¼ˆå¯é€‰é¢„æ£€æŸ¥ï¼‰
3. æ˜¾ç¤ºè´¨æŠ¼è¦æ±‚ï¼š"æ³¨å†Œéœ€è¦è´¨æŠ¼ 1000 $TRUST"
4. æ˜¾ç¤ºå½“å‰é’±åŒ…çš„ $TRUST ä½™é¢ï¼ˆè°ƒç”¨ TrustToken åˆçº¦ `balanceOf`ï¼‰
5. å¦‚æœä½™é¢ < 1000ï¼Œæ˜¾ç¤ºè­¦å‘Šï¼š"ä½™é¢ä¸è¶³ï¼Œè¯·å…ˆè·å– $TRUST ä»£å¸"
6. å®ç°æ³¨å†Œæµç¨‹ï¼ˆå¤šæ­¥éª¤ï¼‰ï¼š
   - æ­¥éª¤ 1ï¼šæˆæƒï¼ˆè°ƒç”¨ TrustToken `approve(AgentRegistry, 1000 * 10^18)`ï¼‰
   - æ­¥éª¤ 2ï¼šæ³¨å†Œï¼ˆè°ƒç”¨ AgentRegistry `registerAgent(serviceEndpoint)`ï¼‰
7. ä½¿ç”¨ shadcn Stepper æˆ– Progress æ˜¾ç¤ºå½“å‰æ­¥éª¤
8. æˆæƒå’Œæ³¨å†Œäº¤æ˜“ä½¿ç”¨ wagmi `useWriteContract`
9. äº¤æ˜“æäº¤åï¼Œæ˜¾ç¤º"äº¤æ˜“å¤„ç†ä¸­"çŠ¶æ€ + Arbiscan é“¾æ¥
10. äº¤æ˜“ç¡®è®¤åï¼Œæ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯ï¼š"ğŸ‰ æ³¨å†ŒæˆåŠŸï¼æ‚¨ç°åœ¨æ˜¯ Trustless SocialFi çš„ Agent"
11. è‡ªåŠ¨è·³è½¬åˆ° Agent åˆ—è¡¨é¡µï¼Œæ–°æ³¨å†Œçš„ Agent æ˜¾ç¤ºåœ¨åˆ—è¡¨ä¸­
12. é”™è¯¯å¤„ç†ï¼šæˆæƒæ‹’ç»ã€äº¤æ˜“å¤±è´¥ã€ä½™é¢ä¸è¶³ï¼Œæ˜¾ç¤ºå‹å¥½é”™è¯¯ä¿¡æ¯

---

## ğŸ¤” Epic 2 è®¾è®¡ç†ç”±

**Story é¡ºåºï¼š**

1. **2.1 ä»£å¸åˆçº¦** - åŸºç¡€ï¼Œæ‰€æœ‰åç»­ Stories ä¾èµ–
2. **2.2 Agent æ³¨å†Œåˆçº¦** - ä¾èµ– 2.1ï¼ˆä»£å¸å­˜åœ¨ï¼‰
3. **2.3 åç«¯ API** - ä¾èµ– 2.2ï¼ˆåˆçº¦å­˜åœ¨ï¼‰
4. **2.4 Agent åˆ—è¡¨é¡µ** - ä¾èµ– 2.3ï¼ˆAPI å­˜åœ¨ï¼‰
5. **2.5 æ³¨å†Œç•Œé¢** - ä¾èµ– 2.1ã€2.2ï¼ˆåˆçº¦å­˜åœ¨ï¼‰

**å¯äº¤ä»˜ä»·å€¼ï¼š**

- Epic 2 å®Œæˆåï¼šAgent å¯ä»¥æ³¨å†Œã€ç”¨æˆ·å¯ä»¥æŸ¥çœ‹ Agent ç½‘ç»œçŠ¶æ€
- ä¸º Epic 4 çš„å®¡æ ¸ç³»ç»Ÿå‡†å¤‡å¥½ Agent æ± 

---

## ğŸ¯ è¯·é€‰æ‹©ä¸‹ä¸€æ­¥

**1.** ç»§ç»­ Epic 3ï¼ˆContent Publishing & IPFS Storageï¼‰

**2.** è°ƒæ•´ Epic 2 çš„ Stories

**3.** æ·±åŒ–æŸä¸ª Storyï¼ˆå¦‚ï¼š2.1 ä»£å¸åˆçº¦çš„ä»£å¸åˆ†é…ç­–ç•¥ï¼‰

---
