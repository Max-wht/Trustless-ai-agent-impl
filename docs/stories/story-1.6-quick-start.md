# Story 1.6 å¿«é€Ÿå¯åŠ¨æŒ‡å—

æœ¬æŒ‡å—å¸®åŠ©æ‚¨å¿«é€Ÿæµ‹è¯•ç”¨æˆ·æ³¨å†ŒåŠŸèƒ½çš„å®Œæ•´ç«¯åˆ°ç«¯æµç¨‹ã€‚

---

## å‰ç½®æ¡ä»¶

1. âœ… **MetaMask** å·²å®‰è£…ï¼ˆæµè§ˆå™¨æ‰©å±•ï¼‰
2. âœ… **PostgreSQL** æ­£åœ¨è¿è¡Œ
3. âœ… **Node.js 20+** å’Œ **pnpm** å·²å®‰è£…

---

## å¯åŠ¨æ­¥éª¤

### 1. å¯åŠ¨ Anvil æœ¬åœ°åŒºå—é“¾

åœ¨**ç»ˆç«¯ 1**è¿è¡Œï¼š

```bash
cd packages/contracts
anvil
```

**é¢„æœŸè¾“å‡º**:

```
Available Accounts
==================
(0) 0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266 (10000 ETH)
...

Private Keys
==================
(0) 0xac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80
...

Listening on 127.0.0.1:8545
```

ä¿æŒæ­¤ç»ˆç«¯è¿è¡Œã€‚

---

### 2. éƒ¨ç½² UserRegistry åˆçº¦

åœ¨**ç»ˆç«¯ 2**è¿è¡Œï¼š

```bash
cd packages/contracts

forge script script/DeployUserRegistry.s.sol:DeployUserRegistry \
  --rpc-url http://localhost:8545 \
  --broadcast \
  --private-key 0xac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80
```

**é¢„æœŸè¾“å‡º**:

```
UserRegistry deployed at: 0xe7f1725E7734CE288F8367e1Bb143E90bb3F0512
âœ… Sequence #1 on anvil-hardhat
```

---

### 3. å¯åŠ¨åç«¯ API

åœ¨**ç»ˆç«¯ 3**è¿è¡Œï¼š

```bash
cd packages/agent-service

# ç¡®ä¿ ABI æ–‡ä»¶å­˜åœ¨
mkdir -p dist/abis
cp src/abis/UserRegistry.json dist/abis/

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
pnpm dev
```

**é¢„æœŸè¾“å‡º**:

```
Agent service listening on http://0.0.0.0:3001
```

ä¿æŒæ­¤ç»ˆç«¯è¿è¡Œã€‚

---

### 4. å¯åŠ¨å‰ç«¯åº”ç”¨

åœ¨**ç»ˆç«¯ 4**è¿è¡Œï¼š

```bash
cd packages/web-app
pnpm dev
```

**é¢„æœŸè¾“å‡º**:

```
  â–² Next.js 14.1.0
  - Local:        http://localhost:3000
  âœ“ Ready in 2.3s
```

ä¿æŒæ­¤ç»ˆç«¯è¿è¡Œã€‚

---

## æµ‹è¯•æµç¨‹

### æ­¥éª¤ 1: æ‰“å¼€åº”ç”¨

åœ¨æµè§ˆå™¨è®¿é—®: **http://localhost:3000**

### æ­¥éª¤ 2: è¿æ¥ MetaMask

1. ç‚¹å‡»å³ä¸Šè§’ **"è¿æ¥é’±åŒ…"** æŒ‰é’®
2. é€‰æ‹© **MetaMask**
3. åœ¨ MetaMask å¼¹çª—ä¸­ç‚¹å‡» **"ä¸‹ä¸€æ­¥"** â†’ **"è¿æ¥"**

### æ­¥éª¤ 3: æ·»åŠ  Anvil ç½‘ç»œåˆ° MetaMask

å¦‚æœ MetaMask æœªè¿æ¥åˆ° Anvilï¼Œéœ€è¦æ‰‹åŠ¨æ·»åŠ ç½‘ç»œï¼š

1. æ‰“å¼€ MetaMask
2. ç‚¹å‡»ç½‘ç»œä¸‹æ‹‰èœå•
3. ç‚¹å‡» **"æ·»åŠ ç½‘ç»œ"**
4. ç‚¹å‡» **"æ‰‹åŠ¨æ·»åŠ ç½‘ç»œ"**
5. å¡«å†™ä»¥ä¸‹ä¿¡æ¯ï¼š
   - **ç½‘ç»œåç§°**: Anvil Local
   - **RPC URL**: http://localhost:8545
   - **é“¾ ID**: 31337
   - **è´§å¸ç¬¦å·**: ETH
6. ç‚¹å‡» **"ä¿å­˜"**

### æ­¥éª¤ 4: å¯¼å…¥æµ‹è¯•è´¦æˆ·

1. æ‰“å¼€ MetaMask
2. ç‚¹å‡»è´¦æˆ·å›¾æ ‡ â†’ **"å¯¼å…¥è´¦æˆ·"**
3. ç²˜è´´ Anvil æä¾›çš„ç§é’¥:
   ```
   0xac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80
   ```
4. ç‚¹å‡» **"å¯¼å…¥"**

ç°åœ¨æ‚¨çš„æµ‹è¯•è´¦æˆ·åº”è¯¥æœ‰ **10000 ETH** ä½™é¢ã€‚

### æ­¥éª¤ 5: ç­¾åæ³¨å†Œ

é’±åŒ…è¿æ¥æˆåŠŸåï¼Œåº”ç”¨ä¼š**è‡ªåŠ¨è§¦å‘æ³¨å†Œæµç¨‹**ï¼š

1. MetaMask å¼¹å‡ºç­¾åè¯·æ±‚
2. æ¶ˆæ¯å†…å®¹: **"Sign in to Trustless SocialFi"**
3. ç‚¹å‡» **"ç­¾å"**

### æ­¥éª¤ 6: ç­‰å¾…æ³¨å†Œå®Œæˆ

é¡µé¢ä¼šæ˜¾ç¤º:

- ğŸ”„ **æ­£åœ¨æ³¨å†Œæ‚¨çš„è´¦æˆ·ï¼Œè¯·ç¨å€™...**

æ³¨å†Œè¿‡ç¨‹åŒ…æ‹¬ï¼š

1. éªŒè¯ç­¾å
2. è°ƒç”¨æ™ºèƒ½åˆçº¦
3. å†™å…¥æ•°æ®åº“

### æ­¥éª¤ 7: æŸ¥çœ‹ä¸ªäººä¸»é¡µ

æ³¨å†ŒæˆåŠŸåï¼Œé¡µé¢ä¼š**è‡ªåŠ¨è·³è½¬**åˆ°:

```
http://localhost:3000/profile/0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266
```

æ‚¨åº”è¯¥çœ‹åˆ°:

- âœ… **æ³¨å†ŒæˆåŠŸï¼è¿™æ˜¯æ‚¨çš„ä¸ªäººä¸»é¡µã€‚**
- æ˜¾ç¤ºæ‚¨çš„é’±åŒ…åœ°å€

---

## éªŒè¯æ•°æ®

### éªŒè¯é“¾ä¸Šæ•°æ®

åœ¨**ç»ˆç«¯**è¿è¡Œï¼š

```bash
cd packages/contracts

cast call 0xe7f1725E7734CE288F8367e1Bb143E90bb3F0512 \
  "isRegistered(address)" \
  0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266 \
  --rpc-url http://localhost:8545
```

**é¢„æœŸè¾“å‡º**: `true` (0x01)

### éªŒè¯æ•°æ®åº“æ•°æ®

ä½¿ç”¨ Prisma Studioï¼š

```bash
cd packages/agent-service
pnpm prisma:studio
```

åœ¨æµè§ˆå™¨æ‰“å¼€ http://localhost:5555ï¼ŒæŸ¥çœ‹ **User** è¡¨ã€‚

### éªŒè¯ API æ•°æ®

```bash
curl http://localhost:3001/users/0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266 | jq
```

**é¢„æœŸè¾“å‡º**:

```json
{
  "id": "cm2x...",
  "walletAddress": "0xf39fd6e51aad88f6f4ce6ab8827279cfffb92266",
  "username": "",
  "bio": "",
  "createdAt": "2025-10-11T...",
  "updatedAt": "2025-10-11T..."
}
```

---

## æµ‹è¯•å·²æ³¨å†Œç”¨æˆ·

### åœºæ™¯: åˆ·æ–°é¡µé¢

1. åœ¨ http://localhost:3000 åˆ·æ–°é¡µé¢
2. é’±åŒ…åº”è‡ªåŠ¨é‡è¿
3. åº”ç”¨æ£€æµ‹åˆ°ç”¨æˆ·å·²æ³¨å†Œ
4. **ä¸ä¼š**å†æ¬¡è§¦å‘æ³¨å†Œ
5. æ˜¾ç¤ºæ­£å¸¸ç•Œé¢

### åœºæ™¯: æ–­å¼€å¹¶é‡è¿

1. åœ¨ MetaMask ä¸­æ–­å¼€è¿æ¥
2. é‡æ–°ç‚¹å‡» "è¿æ¥é’±åŒ…"
3. æˆæƒè¿æ¥
4. åº”ç”¨æ£€æµ‹åˆ°å·²æ³¨å†Œ
5. **ä¸ä¼š**é‡å¤æ³¨å†Œ

---

## æ•…éšœæ’é™¤

### é—®é¢˜ 1: "RPC endpoint not found"

**åŸå› **: Anvil æœªè¿è¡Œ

**è§£å†³æ–¹æ¡ˆ**:

```bash
cd packages/contracts
anvil
```

### é—®é¢˜ 2: "Failed to fetch"

**åŸå› **: åç«¯ API æœªè¿è¡Œ

**è§£å†³æ–¹æ¡ˆ**:

```bash
cd packages/agent-service
pnpm dev
```

### é—®é¢˜ 3: "User already registered"

**åŸå› **: è¯¥é’±åŒ…åœ°å€å·²ç»æ³¨å†Œè¿‡

**è§£å†³æ–¹æ¡ˆ**:

- ä½¿ç”¨ä¸åŒçš„ MetaMask è´¦æˆ·ï¼Œæˆ–
- é‡å¯ Anvil å’Œåç«¯ï¼ˆä¼šæ¸…ç©ºæ•°æ®ï¼‰

### é—®é¢˜ 4: ç­¾ååå¡ä½

**åŸå› **: åŒºå—é“¾äº¤æ˜“å¯èƒ½å¤±è´¥

**æ£€æŸ¥**:

1. Anvil ç»ˆç«¯æ˜¯å¦æœ‰é”™è¯¯æ—¥å¿—
2. åç«¯ç»ˆç«¯æ˜¯å¦æœ‰é”™è¯¯æ—¥å¿—
3. æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**:

- åˆ·æ–°é¡µé¢é‡è¯•
- æ£€æŸ¥åˆçº¦åœ°å€æ˜¯å¦æ­£ç¡®

---

## æ¸…ç†å’Œé‡ç½®

### é‡ç½®æ‰€æœ‰æ•°æ®

```bash
# 1. åœæ­¢æ‰€æœ‰æœåŠ¡ (Ctrl+C)

# 2. æ¸…ç©ºæ•°æ®åº“
cd packages/agent-service
pnpm prisma migrate reset

# 3. é‡æ–°å¯åŠ¨ Anvilï¼ˆä¼šæ¸…ç©ºé“¾ä¸Šæ•°æ®ï¼‰
cd packages/contracts
anvil

# 4. é‡æ–°éƒ¨ç½²åˆçº¦
forge script script/DeployUserRegistry.s.sol:DeployUserRegistry \
  --rpc-url http://localhost:8545 \
  --broadcast \
  --private-key 0xac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80

# 5. é‡æ–°å¯åŠ¨åç«¯å’Œå‰ç«¯
```

---

## æˆåŠŸæ ‡å¿—

âœ… **å®Œæ•´çš„ç«¯åˆ°ç«¯æµç¨‹æˆåŠŸ** å½“æ‚¨çœ‹åˆ°ï¼š

1. âœ… Anvil æ­£åœ¨è¿è¡Œ (ç»ˆç«¯ 1)
2. âœ… åˆçº¦å·²éƒ¨ç½² (ç»ˆç«¯ 2 è¾“å‡ºåœ°å€)
3. âœ… åç«¯ API æ­£åœ¨ç›‘å¬ 3001 ç«¯å£ (ç»ˆç«¯ 3)
4. âœ… å‰ç«¯åº”ç”¨æ­£åœ¨è¿è¡Œ 3000 ç«¯å£ (ç»ˆç«¯ 4)
5. âœ… MetaMask æˆåŠŸè¿æ¥
6. âœ… ç­¾åè¯·æ±‚å¼¹å‡ºå¹¶æˆåŠŸç­¾å
7. âœ… è‡ªåŠ¨è·³è½¬åˆ°ä¸ªäººä¸»é¡µ
8. âœ… æ˜¾ç¤º "æ³¨å†ŒæˆåŠŸ" æç¤º
9. âœ… `cast call` è¿”å› true
10. âœ… API è¿”å›ç”¨æˆ·æ•°æ®

---

## ä¸‹ä¸€æ­¥

ä½“éªŒå®Œæ•´çš„ç”¨æˆ·æ³¨å†Œæµç¨‹åï¼Œæ‚¨å¯ä»¥ï¼š

1. å°è¯•æ³¨å†Œå¤šä¸ªè´¦æˆ·ï¼ˆåˆ‡æ¢ MetaMask è´¦æˆ·ï¼‰
2. æŸ¥çœ‹ Anvil ç»ˆç«¯çš„äº¤æ˜“æ—¥å¿—
3. ä½¿ç”¨ Prisma Studio æŸ¥çœ‹æ•°æ®åº“è®°å½•
4. å¼€å‘ Story 1.7 - ä¸ªäººä¸»é¡µå®Œå–„

---

**ç¥æ‚¨æµ‹è¯•æ„‰å¿«ï¼** ğŸš€

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹å®Œæ•´çš„éªŒè¯æŠ¥å‘Š: [story-1.6-verification-report.md](./story-1.6-verification-report.md)
