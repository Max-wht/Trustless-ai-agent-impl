# ğŸ¦Š MetaMask è¿æ¥ Anvil - å¿«é€Ÿå¼€å§‹

## ğŸ“Š è¯Šæ–­ç»“æœ

âœ… **Anvil æœ¬åœ°èŠ‚ç‚¹è¿è¡Œæ­£å¸¸**  
âœ… **æ™ºèƒ½åˆçº¦å·²éƒ¨ç½²**  
âœ… **é…ç½®æ–‡ä»¶æ­£ç¡®**

**é—®é¢˜**: MetaMask éœ€è¦æ‰‹åŠ¨æ·»åŠ  Anvil æœ¬åœ°ç½‘ç»œæ‰èƒ½è¿æ¥ã€‚

---

## ğŸš€ 3 åˆ†é’Ÿå¿«é€Ÿè§£å†³

### æ–¹å¼ 1: ä¸€é”®æ·»åŠ ï¼ˆæœ€ç®€å•ï¼‰â­

1. **åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€è¿™ä¸ªæ–‡ä»¶**:

   ```
   file:///Users/max/code/foundry-code/foundry-trustless-ai-agent/add-anvil-network.html
   ```

   æˆ–è€…ç›´æ¥æ‹–æ‹½ `add-anvil-network.html` åˆ°æµè§ˆå™¨

2. **ç‚¹å‡»"æ·»åŠ  Anvil ç½‘ç»œåˆ° MetaMask"æŒ‰é’®**

3. **åœ¨ MetaMask å¼¹çª—ä¸­ç‚¹å‡»"æ‰¹å‡†"**

4. **å®Œæˆï¼** ğŸ‰

---

### æ–¹å¼ 2: æ‰‹åŠ¨æ·»åŠ 

#### æ­¥éª¤ 1: æ‰“å¼€ MetaMask è®¾ç½®

1. ç‚¹å‡» MetaMask æ‰©å±•å›¾æ ‡
2. ç‚¹å‡»é¡¶éƒ¨çš„ç½‘ç»œä¸‹æ‹‰èœå•ï¼ˆå¯èƒ½æ˜¾ç¤º"ä»¥å¤ªåŠä¸»ç½‘"ï¼‰
3. ç‚¹å‡» **"æ·»åŠ ç½‘ç»œ"**
4. ç‚¹å‡» **"æ‰‹åŠ¨æ·»åŠ ç½‘ç»œ"**

#### æ­¥éª¤ 2: å¡«å†™ç½‘ç»œä¿¡æ¯

| å­—æ®µ           | å€¼                      |
| -------------- | ----------------------- |
| **ç½‘ç»œåç§°**   | `Anvil Local`           |
| **æ–° RPC URL** | `http://127.0.0.1:8545` |
| **é“¾ ID**      | `31337`                 |
| **è´§å¸ç¬¦å·**   | `ETH`                   |

#### æ­¥éª¤ 3: ä¿å­˜

ç‚¹å‡» **"ä¿å­˜"**ï¼ŒMetaMask ä¼šè‡ªåŠ¨åˆ‡æ¢åˆ° Anvil Local ç½‘ç»œã€‚

---

## âœ… éªŒè¯è¿æ¥

### 1. å¯åŠ¨åº”ç”¨æœåŠ¡

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•è¿è¡Œ
./start-dev.sh
```

è¿™ä¼šè‡ªåŠ¨å¯åŠ¨ï¼š

- âœ… Anvilï¼ˆå·²è¿è¡Œï¼‰
- âœ… åç«¯ API
- âœ… å‰ç«¯åº”ç”¨

### 2. è®¿é—®åº”ç”¨

æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼šhttp://localhost:3000

### 3. è¿æ¥é’±åŒ…

1. ç‚¹å‡» **"Connect Wallet"** æŒ‰é’®
2. é€‰æ‹© **MetaMask**
3. ç¡®è®¤è¿æ¥
4. å¦‚æœæç¤ºåˆ‡æ¢ç½‘ç»œï¼Œç‚¹å‡» **"åˆ‡æ¢ç½‘ç»œ"**

### 4. æˆåŠŸæ ‡å¿—

è¿æ¥æˆåŠŸåä½ åº”è¯¥çœ‹åˆ°ï¼š

- âœ… å³ä¸Šè§’æ˜¾ç¤ºä½ çš„é’±åŒ…åœ°å€
- âœ… ç½‘ç»œæ˜¾ç¤ºä¸º "Anvil Local"
- âœ… MetaMask æ˜¾ç¤ºè¿æ¥åˆ° localhost:3000

---

## ğŸ§ª æµ‹è¯• Anvil è¿æ¥

### æµè§ˆå™¨æ§åˆ¶å°æµ‹è¯•

æŒ‰ F12 æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°ï¼Œè¿è¡Œï¼š

```javascript
// æ£€æŸ¥ Chain ID
await window.ethereum.request({ method: 'eth_chainId' });
// åº”è¿”å›: "0x7a69" (31337)

// æ£€æŸ¥è¿æ¥
await window.ethereum.request({ method: 'eth_requestAccounts' });
// åº”è¿”å›ä½ çš„è´¦æˆ·åœ°å€æ•°ç»„
```

### å‘½ä»¤è¡Œæµ‹è¯•

```bash
# æµ‹è¯• Anvil RPC
curl -X POST http://127.0.0.1:8545 \
  -H "Content-Type: application/json" \
  -d '{"jsonrpc":"2.0","method":"eth_chainId","params":[],"id":1}'

# åº”è¿”å›: {"jsonrpc":"2.0","id":1,"result":"0x7a69"}
```

---

## ğŸ å¯¼å…¥æµ‹è¯•è´¦æˆ·ï¼ˆå¯é€‰ï¼‰

Anvil æä¾›äº†é¢„å……å€¼çš„æµ‹è¯•è´¦æˆ·ï¼Œæ¯ä¸ªè´¦æˆ·æœ‰ 10,000 ETHã€‚

### æ¨èè´¦æˆ· #0

```
åœ°å€: 0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266
ç§é’¥: 0xac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80
ä½™é¢: 10,000 ETH
```

### å¯¼å…¥æ­¥éª¤

1. æ‰“å¼€ MetaMask
2. ç‚¹å‡»å³ä¸Šè§’è´¦æˆ·å›¾æ ‡
3. é€‰æ‹© **"å¯¼å…¥è´¦æˆ·"**
4. ç²˜è´´ä¸Šé¢çš„ç§é’¥
5. ç‚¹å‡» **"å¯¼å…¥"**

âš ï¸ **è­¦å‘Š**: è¿™æ˜¯å…¬å¼€çš„æµ‹è¯•ç§é’¥ï¼Œä»…ç”¨äºæœ¬åœ°å¼€å‘ï¼Œåˆ‡å‹¿åœ¨ä¸»ç½‘ä½¿ç”¨ï¼

---

## ğŸ› å¸¸è§é—®é¢˜

### Q: æ·»åŠ ç½‘ç»œæ—¶æç¤º"é“¾ ID å·²å­˜åœ¨"

**A**: ä½ å¯èƒ½ä¹‹å‰å·²ç»æ·»åŠ è¿‡äº†ã€‚

è§£å†³æ–¹æ³•ï¼š

1. åœ¨ MetaMask è®¾ç½®ä¸­æ‰¾åˆ° Chain ID 31337 çš„ç½‘ç»œ
2. ç¼–è¾‘æˆ–åˆ é™¤å®ƒ
3. é‡æ–°æ·»åŠ 

### Q: è¿æ¥åæ˜¾ç¤º"æ— æ³•è¿æ¥åˆ°ç½‘ç»œ"

**A**: ç¡®ä¿æ‰€æœ‰æœåŠ¡éƒ½åœ¨è¿è¡Œï¼š

```bash
# è¿è¡Œè¯Šæ–­è„šæœ¬
./diagnose-connection.sh

# å¦‚æœæœ‰æœåŠ¡æœªè¿è¡Œï¼Œé‡å¯æ‰€æœ‰æœåŠ¡
./start-dev.sh
```

### Q: MetaMask æ˜¾ç¤ºä½™é¢ä¸º 0

**A**: å¯èƒ½çš„åŸå› ï¼š

1. **ä½¿ç”¨çš„æ˜¯ä¸»ç½‘è´¦æˆ·**: åˆ‡æ¢åˆ°å¯¼å…¥çš„ Anvil æµ‹è¯•è´¦æˆ·
2. **ç½‘ç»œç¼“å­˜é—®é¢˜**: åœ¨ MetaMask ä¸­åˆ·æ–°è´¦æˆ·ä½™é¢
3. **Anvil é‡å¯äº†**: é‡æ–°å¯åŠ¨åéœ€è¦é‡æ–°å¯¼å…¥è´¦æˆ·

### Q: ç­¾åæ—¶æŠ¥é”™"æ— æ³•ä¼°ç®— gas"

**A**: ç¡®ä¿æ™ºèƒ½åˆçº¦å·²éƒ¨ç½²ï¼š

```bash
cd packages/contracts
forge script script/DeployUserRegistry.s.sol:DeployUserRegistry \
  --rpc-url http://localhost:8545 \
  --private-key 0xac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80 \
  --broadcast
```

---

## ğŸ“‹ ç½‘ç»œé…ç½®é€ŸæŸ¥è¡¨

| å‚æ•°       | å€¼                    |
| ---------- | --------------------- |
| ç½‘ç»œåç§°   | Anvil Local           |
| RPC URL    | http://127.0.0.1:8545 |
| Chain ID   | 31337 (0x7a69)        |
| è´§å¸ç¬¦å·   | ETH                   |
| åŒºå—æµè§ˆå™¨ | æ— ï¼ˆæœ¬åœ°ç½‘ç»œï¼‰        |

---

## ğŸ”§ å·¥å…·å’Œå‘½ä»¤

### è¯Šæ–­å·¥å…·

```bash
# å®Œæ•´è¯Šæ–­
./diagnose-connection.sh

# æ£€æŸ¥ Anvil çŠ¶æ€
lsof -i :8545

# æŸ¥çœ‹ Anvil æ—¥å¿—
tail -f /tmp/anvil.log
```

### æœåŠ¡ç®¡ç†

```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡
./start-dev.sh

# åœæ­¢æ‰€æœ‰æœåŠ¡
./stop-dev.sh

# æ‰‹åŠ¨å¯åŠ¨ Anvil
cd packages/contracts && anvil

# æ‰‹åŠ¨å¯åŠ¨åç«¯
pnpm --filter @trustless/agent-service dev

# æ‰‹åŠ¨å¯åŠ¨å‰ç«¯
pnpm --filter @trustless/web-app dev
```

---

## ğŸ“š è¯¦ç»†æ–‡æ¡£

- ğŸ“– [å®Œæ•´ MetaMask è¿æ¥æŒ‡å—](./METAMASK-ANVIL-CONNECTION-GUIDE.md)
- ğŸ§ª [Story 1.7 æµ‹è¯•æŒ‡å—](./stories/story-1.7-testing-guide.md)
- ğŸ”§ [500 é”™è¯¯å¿«é€Ÿä¿®å¤](./stories/story-1.7-quickfix-500-error.md)
- ğŸš€ [é¡¹ç›®è®¾ç½®æŒ‡å—](../SETUP.md)

---

## ğŸ’¡ æç¤º

### Anvil ç‰¹ç‚¹

- âœ… **å³æ—¶æŒ–çŸ¿**: äº¤æ˜“ç«‹å³ç¡®è®¤ï¼ˆ0 ç§’åŒºå—æ—¶é—´ï¼‰
- âœ… **é¢„å……å€¼è´¦æˆ·**: 10 ä¸ªè´¦æˆ·ï¼Œæ¯ä¸ª 10,000 ETH
- âœ… **ç¡®å®šæ€§åœ°å€**: æ¯æ¬¡å¯åŠ¨ä½¿ç”¨ç›¸åŒçš„ç§é’¥
- âš ï¸ **ä¸´æ—¶çŠ¶æ€**: é‡å¯åæ‰€æœ‰æ•°æ®æ¸…ç©º

### å¼€å‘å·¥ä½œæµ

1. **é¦–æ¬¡å¯åŠ¨**: è¿è¡Œ `./start-dev.sh`
2. **æ·»åŠ ç½‘ç»œ**: åœ¨ MetaMask ä¸­æ·»åŠ  Anvil Localï¼ˆä»…éœ€ä¸€æ¬¡ï¼‰
3. **å¯¼å…¥è´¦æˆ·**: å¯¼å…¥æµ‹è¯•è´¦æˆ·ï¼ˆä»…éœ€ä¸€æ¬¡ï¼‰
4. **æ—¥å¸¸ä½¿ç”¨**: ç¡®ä¿ MetaMask åˆ‡æ¢åˆ° Anvil Local ç½‘ç»œ

### é‡å¯å»ºè®®

å¦‚æœé‡åˆ°ä»»ä½•é—®é¢˜ï¼š

```bash
# å®Œå…¨é‡å¯
./stop-dev.sh
./start-dev.sh

# æ¸…é™¤æµè§ˆå™¨ç¼“å­˜
# Chrome/Edge: Ctrl+Shift+R (Windows) / Cmd+Shift+R (Mac)
```

---

## âœ¨ ä¸‹ä¸€æ­¥

æ·»åŠ  Anvil ç½‘ç»œåï¼Œä½ å¯ä»¥ï¼š

1. âœ… è®¿é—® http://localhost:3000
2. âœ… è¿æ¥ MetaMask é’±åŒ…
3. âœ… æ³¨å†Œç”¨æˆ·è´¦æˆ·
4. âœ… æŸ¥çœ‹ä¸ªäººä¸»é¡µ
5. âœ… å¼€å§‹ä½¿ç”¨ Trustless SocialFiï¼

---

**éœ€è¦å¸®åŠ©ï¼Ÿ**

- ğŸ› æŸ¥çœ‹è¯¦ç»†æ—¥å¿—: `tail -f /tmp/*.log`
- ğŸ” è¿è¡Œè¯Šæ–­: `./diagnose-connection.sh`
- ğŸ“– é˜…è¯»å®Œæ•´æŒ‡å—: `docs/METAMASK-ANVIL-CONNECTION-GUIDE.md`

---

**æœ€åæ›´æ–°**: 2025-10-11  
**ç»´æŠ¤è€…**: James (Full Stack Developer)
